<ngx-spinner bdOpacity = 0.7 bdColor = "rgba(51,51,51,0.8)" size = "medium" color = "#8eb7cb" type = "ball-clip-rotate-multiple" [fullScreen] = "true">
  <p style="color: white; margin-top: 40px" > Loading... </p>
</ngx-spinner>
<div class="app-title">
  <div>
    <h1>ExternalReqs</h1>
  </div>
</div>
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#Addreq"
  style="margin-right: 155ex; ">Add New Req </button>

<br><br>


<div id="Addreq" class="modal">
  <div class="modal-dialog modal-newsletter">
    <div class="modal-content">
      <div class="modal-body text-left">

        <div class="modal-header">
          <h4 class="modal-title">Add New Req Details</h4>
          <button type="button" class="close" (click)='clear(abc)' data-dismiss="modal">&times;</button>
        </div>

        <form #abc="ngForm" >
        <div class="row">
            <div class="col-sm-6">
              <label style="color: black;">Employee Id </label>
              <input id="user_id" [(ngModel)]="user_id" name="user_id" readonly class="form-control" required="true"
                type="number"> <br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">customers </label>
              <br>
              <select [(ngModel)]="customer_Id" name="customer_Id" required class="form-control" #cusid="ngModel"
                [ngClass]="{'is-invalid':cusid.invalid && cusid.touched}">
                <option *ngFor='let abc of customerName; let i = index' value={{abc.customer_id}}>{{abc.customer_name}}
                </option><br>
              </select>
              <section *ngIf="cusid.invalid && cusid.touched" class="invalid-feedback">
                <p *ngIf="cusid.errors.required">*please select Customer</p>
              </section>
            </div>

            <div class="col-sm-6">
              <label style="color: black; ">Account Manager</label>
              <br>
              <select [(ngModel)]="account_manager" name="account_manager" class="form-control" required
                #acmng="ngModel" [ngClass]="{'is-invalid':acmng.invalid && acmng.touched}">
                <option *ngFor='let abc of acoountManager; let i = index' value={{abc.employee_id}}>
                  {{abc.employee_name}} </option>
              </select> <br>
              <section *ngIf="acmng.invalid && acmng.touched" class="invalid-feedback">
                <p *ngIf="acmng.errors.required">*please select Account Manager</p>
              </section>
            </div>

            <div class="col-sm-6">
              <label style="color: black; ">Skill</label>
              <br>
              <input id="skill" [(ngModel)]="skills" name="skills" placeholder="Enter Skill" class="form-control"
                required="true" type="text" required #skill="ngModel"
                [ngClass]="{'is-invalid':skill.invalid && skill.touched}"><br>
              <section *ngIf="skill.invalid && skill.touched" class="invalid-feedback">
                <p *ngIf="skill.errors.required">*please enter Skills</p>
              </section>
            </div>

            <div class="col-sm-6">
              <label style="color: black; ">Years Of Experince</label>
              <input id="years_of_experince" [(ngModel)]="years_of_experience" name="years_of_experience"
                placeholder="Enter years of experince" required class="form-control" required="true" type="number"
                #yrsexp="ngModel" [ngClass]="{'is-invalid':yrsexp.invalid && yrsexp.touched}" maxlength="2">
              <section *ngIf="yrsexp.invalid && yrsexp.touched" class="invalid-feedback"><br>
                <p *ngIf="yrsexp.errors.required">*please Enter Year of Exp</p>
              </section>
            </div>

            <div class="col-sm-6">
              <label style="color: black; ">Job Location</label>
              <input id="job_location" [(ngModel)]="job_location" name="job_location" placeholder="Enter job location"
                required class="form-control" required="true" type="text" #jblct="ngModel"
                [ngClass]="{'is-invalid':jblct.invalid && jblct.touched}"><br>
              <section *ngIf="jblct.invalid && jblct.touched" class="invalid-feedback">
                <p *ngIf="jblct.errors.required">*please enter job location</p>
              </section>
            </div>

            <div class="col-sm-6">
              <label style="color: black; ">Customer Approved CTC</label>
              <br>
              <input id="customer_approved_budget" [(ngModel)]="customer_approved_budget"
                name="customer_approved_budget" placeholder="Enter customer Approved budget" class="form-control"
                required="true" type="number" required #cusbg="ngModel"
                [ngClass]="{'is-invalid':cusbg.invalid && cusbg.touched}" ><br>
              <section *ngIf="cusbg.invalid && cusbg.touched" class="invalid-feedback">
                <p *ngIf="cusbg.errors.required">*please enter Customer ApprovedCTC </p>
              </section>
            </div>

            <div class="col-sm-6">
              <label style="color: black; ">Expected CTC</label>
              <br>
              <input id="expected_budget" [(ngModel)]="expected_budget" name="expected_budget"
                placeholder="Enter expected budget" class="form-control" required="true" type="number" required
                #exectc="ngModel" [ngClass]="{'is-invalid':exectc.invalid && exectc.touched}"(ngModelChange)="fun()" >
              <section *ngIf="exectc.invalid && exectc.touched" class="invalid-feedback"><br>
                <p *ngIf="exectc.errors.required">*please enter Expected CTC </p>
              </section>
            </div>

            <div class="col-sm-6">
              <label style="color: black; ">Margin</label>
              <br>
              <input id="margin" [(ngModel)]="margin" name="margin" placeholder="Enter Margin" class="form-control"
                required="true" type="number"  required readonly><br>
            </div>
            
            <div class="col-sm-6">
              <label style="color: black; ">Expected Date Of Joining</label>
              <br>
              <input id="date_of_joining" [(ngModel)]="date_of_joining" name="date_of_joining"
                placeholder="Enter Expected Date Of Joining" class="form-control" required="true" type="date"
                min="{{currentDate | date:'yyyy-MM-dd'}}" required #exedate="ngModel"
                [ngClass]="{'is-invalid':exedate.invalid && exedate.touched}"><br>
              <section *ngIf="exedate.invalid && exedate.touched" class="invalid-feedback">
                <p *ngIf="exedate.errors.required">*please select Expected Date Of Joining </p>
              </section>
            </div>

            <div class="col-sm-6">
              <label style="color: black; ">Notice period</label>
              <br>
              <input id="notice_period period" min="{{currentDate | date:'yyyy-MM-dd'}}" [(ngModel)]="notice_period"
                name="notice_period" placeholder="Enter Notice period" class="form-control" required="true" type="date"
                required #np="ngModel" [ngClass]="{'is-invalid':np.invalid && np.touched}">
              <section *ngIf="np.invalid && np.touched" class="invalid-feedback"><br>
                <p *ngIf="np.errors.required">*please select Expected Date Of Joining </p>
              </section>
            </div>

          </div>
          <!-- status report -->
          <div class="row" *ngIf="showMsg">
            <div class="col-xs-12">
              <p class="alert alert-success">
                <strong>Req Added Success!</strong> Please refresh page

              </p>
            </div>
          </div>


          <div class="modal-footer">
            <div class="row">
              <div>
                <button type="submit" class="btn btn-primary" data-dismiss="modal" (click)="add_ext_req(abc.value)" [disabled]="abc.invalid">Submit</button>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

<div class="jumbotron" *ngIf="!bool">
    <h1 style="text-align: center">{{notify}}</h1>
  </div>
  

<div class="row top table-responsive" style="margin-right: 0px; margin-left: 0px;" *ngIf='bool'>
  <table class="table table-condensed tile ">
    <thead>
      <tr>
        <th>S.No</th>
        <th>External Id</th>
        <th>Skills</th>
        <th>Customer Name</th>
        <th>Job Location</th>
        <th>Status</th>
        <th>Edit</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of externalList | paginate: { itemsPerPage: perPage, currentPage: currentpage, totalItems: totalitems };let i= index">
        <td>{{i+1}}</td>
        <td><a href="" class="trigger-btn" data-toggle="modal" data-target="#feedback"
          (click)=feedback(item.external_id) title="feedback">{{item.external_id}}</a></td>
        <td>{{item.skills}}</td>
        <td>{{item.customer_name}}</td>
        <td>{{item.job_location}}</td>
        <td *ngIf="item.status === 'Approved'">
          <span class="approved">{{item.status}}</span>
        </td>
        <td *ngIf="item.status === 'Raised'">
            <span class="raised">{{item.status}}</span>
          </td>
          <td *ngIf="item.status === 'Rejected'">
            <span class="rejected">{{item.status}}</span>
            </td>
            <td *ngIf="item.status === 'Sentback'">
                <span class="sentback">{{item.status}}</span>
              </td>
        <td (click)='edit(item)' > <img src="assets/pen.png" height="20" data-toggle="modal" data-target="#myEditModal"
                      width="20"></td>
        <td> <img src="assets/delete.png" height="20" width="20" data-toggle="modal" data-target="#Deletedata"
            (click)='del(item.external_id)'></td>
      <tr>
      </tr>
    </tbody>
  </table>

<pagination-controls (pageChange)="pagechange($event)" class="pull-right"></pagination-controls>

  


 
</div>






<div id="myEditModal" class="modal">
  <div class="modal-dialog modal-newsletter">
    <div class="modal-content">
      <div class="modal-body text-left">

        <div class="modal-header">
          <h4 class="modal-title">Add Req</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <form #editform="ngForm" (submit)=update_ext_req(editform)>
          <div class="row">

            <div class="col-sm-6">
              <label style="color: black; ">Employee Id:</label>
              <input id="user_id" [(ngModel)]="edit_user_id" name="edit_user_id" readonly class="form-control"
                required="true" type="text"> <br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">ExternalReq Id</label>
              <input id="external_id" [(ngModel)]="edit_external_id" name="edit_external_id" readonly
                class="form-control" required="true" type="number"><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">customers:</label>
              <br>
              <select [(ngModel)]="edit_customer_Id" name="edit_customer_Id" required="required" class="form-control">
                <option *ngFor='let abc of customerName; let i = index' value={{abc.customer_id}}>{{abc.customer_name}}
                </option>
              </select><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">Account Manager</label>
              <br>
              <select [(ngModel)]="edit_account_manager" name="edit_account_manager" required="required"
                class="form-control">
                <option value="" selected disabled>Select Account Manager</option>
                <option *ngFor='let abc of acoountManager; let i = index' value={{abc.employee_id}}>
                  {{abc.employee_name}} </option>
              </select><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">Skill</label>
              <br>
              <input id="skill" [(ngModel)]="edit_skills" name="edit_skills" placeholder="skill" class="form-control"
                required="true" type="text"><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">Years Of Experince</label>
              <input id="years_of_experince" [(ngModel)]="edit_years_of_experience" name="edit_years_of_experience"
                placeholder="years_of_experince" class="form-control" required="true" type="number"><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">Job Location</label>
              <input id="job_location" [(ngModel)]="edit_job_location" name="edit_job_location"
                placeholder="job_location" class="form-control" required="true" type="text"><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">Customer Approved CTC</label>
              <br>
              <input id="edit_customer_offer_ctc" [(ngModel)]="edit_customer_approved_budget"
                name="edit_customer_approved_budget" placeholder="customer_approved_budget" class="form-control"
                required="true" type="number" (ngModelChange)="fun1()"><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">Expected CTC</label>
              <br>
              <input id="expected_budget" [(ngModel)]="edit_expected_budget" name="edit_expected_budget"
                placeholder="expected_budget" class="form-control" required="true" type="number" (ngModelChange)="fun1()"><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">Margin</label>
              <br>
              <input id="margin" [(ngModel)]="edit_margin" name="edit_margin" placeholder="Margin" class="form-control"
                required="true" type="number" readonly><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">Expected Date Of Joining</label>
              <br>
              <input id="date_of_joining" min="{{currentDate | date:'yyyy-MM-dd'}}" [(ngModel)]="edit_date_of_joining"
                name="edit_date_of_joining" placeholder="Expected_Date_Of_Joining" class="form-control" required="true"
                type="date"><br>
            </div>
            <div class="col-sm-6">
              <label style="color: black; ">Notice period</label>
              <br>
              <input id="notice_period period" min="{{currentDate | date:'yyyy-MM-dd'}}"
                [(ngModel)]="edit_notice_period" name="edit_notice_period" placeholder="Notice period"
                class="form-control" required="true" type="date"><br>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" data-dismiss="modal"
              (click)=update_ext_req(editform) [disabled]='editform.invalid'>Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>



<div class="modal" id="feedback">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" >Feedback</h4>
      </div><br>
  <!-- Modal body -->
 <div style="margin: 5px; " >
  <div class="row top table-responsive" style="margin-right: 0px; margin-left: 0px;">
    <table class="table table-condensed tile " *ngIf = "f_data">
      <thead>
        <tr> 
          <th>Message </th>
          <th>Request Raised Date</th>
          <th>Reviewed By </th>
          <th> Reviewed Date</th>
          <th>Role Name</th>
          <th>Status</th>
        
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of feedbackList" >
       
          <td>{{item.message}}</td>
          <td>{{item.request_raised_date}}</td>
          <td>{{item.reviewedBy}}</td>
          <td>{{item.reviewedOn}}</td>
          <td>{{item.role_name}}</td>
  
          <td *ngIf="item.status === 'Approved'">
            <span class="approved">{{item.status}}</span>
          </td>
          <td *ngIf="item.status === 'Raised'">
              <span class="raised">{{item.status}}</span>
            </td>
            <td *ngIf="item.status === 'Rejected'">
              <span class="rejected">{{item.status}}</span>
              </td>
              <td *ngIf="item.status === 'Send Back'">
                  <span class="sentback">{{item.status}}</span>
                </td>
        <tr>
        </tr>
      </tbody>
    </table>
  
  </div>
  </div>


  <!-- Modal footer -->
    <div class="offset-lg-0 col-lg-12">
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary text-center" data-dismiss="modal"
          (click)=erase() >close</button>
    </div>
    </div>
</div>
</div>
</div>
<!-- <div class="container" *ngIf = "rd_data">
<div class="jumbotron">
<h3 class="text-center">No reqs have been raised </h3>      
 <p>Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive, mobile-first projects on the web.</p> 
</div>    
</div>  -->